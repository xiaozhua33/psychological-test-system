(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[859],{1264:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},2099:(e,s,t)=>{"use strict";t.d(s,{N:()=>a});let a=(0,t(5647).UU)("https://wbvdvxgdtnpuedqsyvyc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzI2OTc2NDgzLCJleHAiOjIwNDI1NTI0ODN9.Dx10LqwjcB1UB3tr6ZVJTKKnIX4S4itZED_jEFtUlFY")},2657:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2919:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},3232:(e,s,t)=>{Promise.resolve().then(t.bind(t,4177))},4177:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var a=t(5155),r=t(2115),l=t(5695),i=t(6874),n=t.n(i),c=t(4541),d=t(4615),o=t(1264),u=t(2919),m=t(8749),x=t(2657),h=t(3568);function p(){let[e,s]=(0,r.useState)(""),[t,i]=(0,r.useState)(""),[p,y]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!1),{signIn:v}=(0,c.A)(),N=(0,l.useRouter)(),g=async s=>{s.preventDefault(),b(!0);try{let{error:s}=await v(e,t);s?s.message.includes("Invalid login credentials")?h.Ay.error("メールアドレスまたはパスワードが間違っています"):h.Ay.error("ログインに失敗しました"):(h.Ay.success("ログイン成功！"),N.push("/"))}catch(e){h.Ay.error("ログインに失敗しました")}finally{b(!1)}};return(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(d.A,{}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold gradient-text mb-2",children:"ログイン"}),(0,a.jsx)("p",{className:"text-gray-600",children:"アカウントにログインしてテストを楽しみましょう"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(o.A,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{id:"email",type:"email",value:e,onChange:e=>s(e.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all",placeholder:"your@email.com",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(u.A,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{id:"password",type:p?"text":"password",value:t,onChange:e=>i(e.target.value),className:"block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all",placeholder:"パスワードを入力",required:!0}),(0,a.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>y(!p),children:p?(0,a.jsx)(m.A,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"}):(0,a.jsx)(x.A,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})]}),(0,a.jsx)("button",{type:"submit",disabled:f,className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:f?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"ログイン中..."]}):"ログイン"})]}),(0,a.jsx)("div",{className:"mt-6 text-center",children:(0,a.jsxs)("p",{className:"text-gray-600",children:["アカウントをお持ちでない方はこちら",(0,a.jsx)(n(),{href:"/auth/signup",className:"text-brand-600 hover:text-brand-700 font-medium ml-1",children:"新規登録"})]})})]})]})})]})}},4541:(e,s,t)=>{"use strict";t.d(s,{A:()=>c,default:()=>d});var a=t(5155),r=t(2115),l=t(2099),i=t(9509);let n=(0,r.createContext)({}),c=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function d(e){let{children:s}=e,[t,c]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{var e;let{data:{session:s}}=await l.N.auth.getSession();c(null!=(e=null==s?void 0:s.user)?e:null),(null==s?void 0:s.user)&&await x(s.user.id),m(!1)})();let{data:{subscription:e}}=l.N.auth.onAuthStateChange(async(e,s)=>{var t;c(null!=(t=null==s?void 0:s.user)?t:null),(null==s?void 0:s.user)?await x(s.user.id):o(null)});return()=>e.unsubscribe()},[]);let x=async e=>{try{let{data:r,error:i}=await l.N.from("profiles").select("*").eq("id",e).maybeSingle();if(i&&"PGRST116"!==i.code)return void console.error("Error fetching profile:",i);if(!r&&t){var s,a;let{data:r,error:i}=await l.N.from("profiles").insert({id:e,email:t.email,display_name:(null==(s=t.user_metadata)?void 0:s.display_name)||(null==(a=t.email)?void 0:a.split("@")[0]),subscription_status:"free"}).select().maybeSingle();i?console.error("Error creating profile:",i):o(r)}else o(r)}catch(e){console.error("Error in fetchProfile:",e)}},h=async(e,s)=>{let{data:t,error:a}=await l.N.auth.signInWithPassword({email:e,password:s});return{data:t,error:a}},p=async(e,s)=>{let{data:t,error:a}=await l.N.auth.signUp({email:e,password:s,options:{emailRedirectTo:"".concat(i.env.NEXT_PUBLIC_APP_URL,"/auth/callback")}});return{data:t,error:a}},y=async()=>{let{error:e}=await l.N.auth.signOut();return{error:e}};return(0,a.jsx)(n.Provider,{value:{user:t,profile:d,loading:u,signIn:h,signUp:p,signOut:y},children:s})}},4615:(e,s,t)=>{"use strict";t.d(s,{A:()=>o});var a=t(5155),r=t(6874),l=t.n(r),i=t(6766),n=t(1007),c=t(4835),d=t(4541);function o(){let{user:e,profile:s,signOut:t}=(0,d.A)(),r=async()=>{await t()};return(0,a.jsx)("header",{className:"bg-white/95 backdrop-blur-sm border-b border-purple-100 sticky top-0 z-40",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(l(),{href:"/",className:"flex items-center space-x-2 group",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(i.default,{src:"/images/logo.png",alt:"ココロトリックスラボ",width:40,height:40,className:"group-hover:scale-105 transition-transform"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold gradient-text group-hover:scale-105 transition-transform",children:"ココロトリックスラボ"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 hidden sm:block",children:"心理テスト・診断アプリ"})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:e?(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)(l(),{href:"/mypage",className:"flex items-center space-x-2 text-gray-600 hover:text-brand-600 transition-colors",children:[(0,a.jsx)(n.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline text-sm",children:(null==s?void 0:s.display_name)||"マイページ"})]}),(null==s?void 0:s.subscription_status)==="unlimited"&&(0,a.jsx)("span",{className:"px-2 py-1 bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-xs font-medium rounded-full",children:"無制限"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors p-2","aria-label":"ログアウト",children:(0,a.jsx)(c.A,{className:"w-4 h-4"})})]}):(0,a.jsx)(l(),{href:"/auth/login",className:"btn-primary text-sm px-4 py-2",children:"ログイン"})})]})})})}},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},8749:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])}},e=>{e.O(0,[647,95,46,568,441,964,358],()=>e(e.s=3232)),_N_E=e.O()}]);