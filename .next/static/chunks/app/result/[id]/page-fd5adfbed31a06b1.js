(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[288],{2099:(e,t,s)=>{"use strict";s.d(t,{N:()=>r});let r=(0,s(5647).UU)("https://wbvdvxgdtnpuedqsyvyc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzI2OTc2NDgzLCJleHAiOjIwNDI1NTI0ODN9.Dx10LqwjcB1UB3tr6ZVJTKKnIX4S4itZED_jEFtUlFY")},2847:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var r=s(5155),a=s(2115),l=s(5695),n=s(4541),i=s(4615),c=s(3786),o=s(9946);let d=(0,o.A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),x=(0,o.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var h=s(9074);let m=(0,o.A)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),u=(0,o.A)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var b=s(2099),p=s(6874),y=s.n(p);function f(){var e;let t=(0,l.useParams)(),s=(0,l.useRouter)(),{user:o}=(0,n.A)(),[p,f]=(0,a.useState)(null),[N,v]=(0,a.useState)(!0),[g,j]=(0,a.useState)(null),w=parseInt(t.id);(0,a.useEffect)(()=>{if(!o)return void s.push("/auth/login");w&&k()},[w,o]);let k=async()=>{v(!0),j(null);try{let{data:e,error:t}=await b.N.from("user_tests").select("\n          *,\n          test:test_id (*)\n        ").eq("id",w).eq("user_id",o.id).maybeSingle();if(t){console.error("Supabase error:",t),j("結果が取得できませんでした");return}if(!e)return void j("結果が見つかりませんでした");f(e)}catch(e){console.error("Error loading result:",e),j("結果が取得できませんでした")}finally{v(!1)}},A=()=>{if(!p)return"";let e=window.location.href;return"「".concat(p.test.title,"」の結果: ").concat(p.result_summary,"\n\nあなたも試してみませんか？ #ココロトリックスラボ\n").concat(e)};return N?(0,r.jsxs)("div",{className:"min-h-screen",children:[(0,r.jsx)(i.A,{}),(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-600"})})})]}):g?(0,r.jsxs)("div",{className:"min-h-screen",children:[(0,r.jsx)(i.A,{}),(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsx)("div",{className:"max-w-2xl mx-auto text-center",children:(0,r.jsxs)("div",{className:"card bg-red-50 border-red-200",children:[(0,r.jsx)("div",{className:"text-red-600 mb-4",children:(0,r.jsx)(c.A,{className:"w-12 h-12 mx-auto mb-4"})}),(0,r.jsx)("h2",{className:"text-xl font-bold text-red-800 mb-2",children:g}),(0,r.jsx)("p",{className:"text-red-600 mb-6",children:"申し訳ございませんが、結果の表示でエラーが発生しました。"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,r.jsxs)("button",{onClick:()=>window.location.reload(),className:"btn-primary",children:[(0,r.jsx)(d,{className:"w-4 h-4 mr-2"}),"再読み込み"]}),(0,r.jsxs)(y(),{href:"/",className:"btn-secondary",children:[(0,r.jsx)(x,{className:"w-4 h-4 mr-2"}),"ホームに戻る"]})]})]})})})]}):p?(0,r.jsxs)("div",{className:"min-h-screen",children:[(0,r.jsx)(i.A,{}),(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-brand-400 to-accent-400 mx-auto mb-4 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-3xl text-white font-bold",children:(null==o||null==(e=o.email)?void 0:e.charAt(0).toUpperCase())||"\uD83E\uDDE0"})}),(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-800 mb-1",children:p.test.title}),(0,r.jsxs)("div",{className:"flex items-center justify-center text-sm text-gray-500",children:[(0,r.jsx)(h.A,{className:"w-4 h-4 mr-1"}),new Date(p.completed_at).toLocaleDateString("ja-JP")]})]}),(0,r.jsxs)("div",{className:"card bg-gradient-to-br from-brand-50 to-accent-50 border-2 border-brand-100 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-center gradient-text mb-4",children:p.result_summary}),(0,r.jsx)("p",{className:"text-gray-700 leading-relaxed text-center",children:p.result_detail})]}),(0,r.jsxs)("button",{onClick:()=>{let e=encodeURIComponent(A()),t="https://social-plugins.line.me/lineit/share?url=".concat(encodeURIComponent(window.location.href),"&text=").concat(e);window.open(t,"_blank","width=600,height=600")},className:"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl mb-3 flex items-center justify-center transition-colors",children:[(0,r.jsx)(m,{className:"w-5 h-5 mr-2"}),"LINEでシェア"]}),(0,r.jsxs)("button",{onClick:()=>{let e=encodeURIComponent(A());window.location.href="https://twitter.com/intent/tweet?text=".concat(e)},className:"w-full bg-black hover:bg-gray-800 text-white font-bold py-4 px-6 rounded-xl mb-3 flex items-center justify-center transition-colors",children:[(0,r.jsx)(u,{className:"w-5 h-5 mr-2"}),"Xで診断をシェア"]}),(0,r.jsxs)("button",{onClick:()=>{p&&s.push("/test/".concat(p.test_id))},className:"w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-4 px-6 rounded-xl mb-6 flex items-center justify-center transition-colors",children:[(0,r.jsx)(d,{className:"w-5 h-5 mr-2"}),"もう一度診断する"]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-center text-gray-800 mb-4",children:"他のテストも試してみませんか？"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,r.jsxs)(y(),{href:"/category/psychology",className:"text-center p-3 rounded-lg border border-gray-200 hover:border-brand-300 hover:bg-brand-50 transition-colors",children:[(0,r.jsx)("span",{className:"text-2xl block mb-1",children:"\uD83E\uDDE0"}),(0,r.jsx)("span",{className:"text-xs text-gray-600",children:"心理"})]}),(0,r.jsxs)(y(),{href:"/category/zodiac",className:"text-center p-3 rounded-lg border border-gray-200 hover:border-brand-300 hover:bg-brand-50 transition-colors",children:[(0,r.jsx)("span",{className:"text-2xl block mb-1",children:"⭐"}),(0,r.jsx)("span",{className:"text-xs text-gray-600",children:"星座"})]}),(0,r.jsxs)(y(),{href:"/category/love",className:"text-center p-3 rounded-lg border border-gray-200 hover:border-brand-300 hover:bg-brand-50 transition-colors",children:[(0,r.jsx)("span",{className:"text-2xl block mb-1",children:"♥️"}),(0,r.jsx)("span",{className:"text-xs text-gray-600",children:"恋愛"})]})]})]})]})})]}):null}},3786:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},4333:(e,t,s)=>{Promise.resolve().then(s.bind(s,2847))},4541:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,default:()=>o});var r=s(5155),a=s(2115),l=s(2099),n=s(9509);let i=(0,a.createContext)({}),c=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function o(e){let{children:t}=e,[s,c]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[x,h]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{var e;let{data:{session:t}}=await l.N.auth.getSession();c(null!=(e=null==t?void 0:t.user)?e:null),(null==t?void 0:t.user)&&await m(t.user.id),h(!1)})();let{data:{subscription:e}}=l.N.auth.onAuthStateChange(async(e,t)=>{var s;c(null!=(s=null==t?void 0:t.user)?s:null),(null==t?void 0:t.user)?await m(t.user.id):d(null)});return()=>e.unsubscribe()},[]);let m=async e=>{try{let{data:a,error:n}=await l.N.from("profiles").select("*").eq("id",e).maybeSingle();if(n&&"PGRST116"!==n.code)return void console.error("Error fetching profile:",n);if(!a&&s){var t,r;let{data:a,error:n}=await l.N.from("profiles").insert({id:e,email:s.email,display_name:(null==(t=s.user_metadata)?void 0:t.display_name)||(null==(r=s.email)?void 0:r.split("@")[0]),subscription_status:"free"}).select().maybeSingle();n?console.error("Error creating profile:",n):d(a)}else d(a)}catch(e){console.error("Error in fetchProfile:",e)}},u=async(e,t)=>{let{data:s,error:r}=await l.N.auth.signInWithPassword({email:e,password:t});return{data:s,error:r}},b=async(e,t)=>{let{data:s,error:r}=await l.N.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(n.env.NEXT_PUBLIC_APP_URL,"/auth/callback")}});return{data:s,error:r}},p=async()=>{let{error:e}=await l.N.auth.signOut();return{error:e}};return(0,r.jsx)(i.Provider,{value:{user:s,profile:o,loading:x,signIn:u,signUp:b,signOut:p},children:t})}},4615:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var r=s(5155),a=s(6874),l=s.n(a),n=s(6766),i=s(1007),c=s(4835),o=s(4541);function d(){let{user:e,profile:t,signOut:s}=(0,o.A)(),a=async()=>{await s()};return(0,r.jsx)("header",{className:"bg-white/95 backdrop-blur-sm border-b border-purple-100 sticky top-0 z-40",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(l(),{href:"/",className:"flex items-center space-x-2 group",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(n.default,{src:"/images/logo.png",alt:"ココロトリックスラボ",width:40,height:40,className:"group-hover:scale-105 transition-transform"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-bold gradient-text group-hover:scale-105 transition-transform",children:"ココロトリックスラボ"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 hidden sm:block",children:"心理テスト・診断アプリ"})]})]}),(0,r.jsx)("div",{className:"flex items-center space-x-4",children:e?(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(l(),{href:"/mypage",className:"flex items-center space-x-2 text-gray-600 hover:text-brand-600 transition-colors",children:[(0,r.jsx)(i.A,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"hidden sm:inline text-sm",children:(null==t?void 0:t.display_name)||"マイページ"})]}),(null==t?void 0:t.subscription_status)==="unlimited"&&(0,r.jsx)("span",{className:"px-2 py-1 bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-xs font-medium rounded-full",children:"無制限"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors p-2","aria-label":"ログアウト",children:(0,r.jsx)(c.A,{className:"w-4 h-4"})})]}):(0,r.jsx)(l(),{href:"/auth/login",className:"btn-primary text-sm px-4 py-2",children:"ログイン"})})]})})})}},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},9074:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])}},e=>{e.O(0,[647,95,46,441,964,358],()=>e(e.s=4333)),_N_E=e.O()}]);