(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[907],{1100:(e,s,t)=>{Promise.resolve().then(t.bind(t,8907))},2099:(e,s,t)=>{"use strict";t.d(s,{N:()=>r});let r=(0,t(5647).UU)("https://wbvdvxgdtnpuedqsyvyc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzI2OTc2NDgzLCJleHAiOjIwNDI1NTI0ODN9.Dx10LqwjcB1UB3tr6ZVJTKKnIX4S4itZED_jEFtUlFY")},4541:(e,s,t)=>{"use strict";t.d(s,{A:()=>c,default:()=>d});var r=t(5155),a=t(2115),n=t(2099),l=t(9509);let i=(0,a.createContext)({}),c=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function d(e){let{children:s}=e,[t,c]=(0,a.useState)(null),[d,o]=(0,a.useState)(null),[m,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{var e;let{data:{session:s}}=await n.N.auth.getSession();c(null!=(e=null==s?void 0:s.user)?e:null),(null==s?void 0:s.user)&&await x(s.user.id),u(!1)})();let{data:{subscription:e}}=n.N.auth.onAuthStateChange(async(e,s)=>{var t;c(null!=(t=null==s?void 0:s.user)?t:null),(null==s?void 0:s.user)?await x(s.user.id):o(null)});return()=>e.unsubscribe()},[]);let x=async e=>{try{let{data:a,error:l}=await n.N.from("profiles").select("*").eq("id",e).maybeSingle();if(l&&"PGRST116"!==l.code)return void console.error("Error fetching profile:",l);if(!a&&t){var s,r;let{data:a,error:l}=await n.N.from("profiles").insert({id:e,email:t.email,display_name:(null==(s=t.user_metadata)?void 0:s.display_name)||(null==(r=t.email)?void 0:r.split("@")[0]),subscription_status:"free"}).select().maybeSingle();l?console.error("Error creating profile:",l):o(a)}else o(a)}catch(e){console.error("Error in fetchProfile:",e)}},h=async(e,s)=>{let{data:t,error:r}=await n.N.auth.signInWithPassword({email:e,password:s});return{data:t,error:r}},p=async(e,s)=>{let{data:t,error:r}=await n.N.auth.signUp({email:e,password:s,options:{emailRedirectTo:"".concat(l.env.NEXT_PUBLIC_APP_URL,"/auth/callback")}});return{data:t,error:r}},f=async()=>{let{error:e}=await n.N.auth.signOut();return{error:e}};return(0,r.jsx)(i.Provider,{value:{user:t,profile:d,loading:m,signIn:h,signUp:p,signOut:f},children:s})}},4615:(e,s,t)=>{"use strict";t.d(s,{A:()=>o});var r=t(5155),a=t(6874),n=t.n(a),l=t(6766),i=t(1007),c=t(4835),d=t(4541);function o(){let{user:e,profile:s,signOut:t}=(0,d.A)(),a=async()=>{await t()};return(0,r.jsx)("header",{className:"bg-white/95 backdrop-blur-sm border-b border-purple-100 sticky top-0 z-40",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(n(),{href:"/",className:"flex items-center space-x-2 group",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(l.default,{src:"/images/logo.png",alt:"ココロトリックスラボ",width:40,height:40,className:"group-hover:scale-105 transition-transform"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-bold gradient-text group-hover:scale-105 transition-transform",children:"ココロトリックスラボ"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 hidden sm:block",children:"心理テスト・診断アプリ"})]})]}),(0,r.jsx)("div",{className:"flex items-center space-x-4",children:e?(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(n(),{href:"/mypage",className:"flex items-center space-x-2 text-gray-600 hover:text-brand-600 transition-colors",children:[(0,r.jsx)(i.A,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"hidden sm:inline text-sm",children:(null==s?void 0:s.display_name)||"マイページ"})]}),(null==s?void 0:s.subscription_status)==="unlimited"&&(0,r.jsx)("span",{className:"px-2 py-1 bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-xs font-medium rounded-full",children:"無制限"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors p-2","aria-label":"ログアウト",children:(0,r.jsx)(c.A,{className:"w-4 h-4"})})]}):(0,r.jsx)(n(),{href:"/auth/login",className:"btn-primary text-sm px-4 py-2",children:"ログイン"})})]})})})}},5196:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9946).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},5695:(e,s,t)=>{"use strict";var r=t(8999);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}})},7951:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9946).A)("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]])},8907:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>S});var r,a=t(5155),n=t(2115),l=t(5695),i="https://js.stripe.com/v3",c=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,d=function(){for(var e=document.querySelectorAll('script[src^="'.concat(i,'"]')),s=0;s<e.length;s++){var t=e[s];if(c.test(t.src))return t}return null},o=function(e){var s=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",t=document.createElement("script");t.src="".concat(i).concat(s);var r=document.head||document.body;if(!r)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(t),t},m=function(e,s){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:s})},u=null,x=null,h=null,p=function(e,s,t){if(null===e)return null;var r=e.apply(void 0,s);return m(r,t),r},f=!1,j=function(){return r?r:r=(null!==u?u:(u=new Promise(function(e,s){if("undefined"==typeof window||"undefined"==typeof document)return void e(null);if(window.Stripe,window.Stripe)return void e(window.Stripe);try{var t,r=d();r?r&&null!==h&&null!==x&&(r.removeEventListener("load",h),r.removeEventListener("error",x),null==(t=r.parentNode)||t.removeChild(r),r=o(null)):r=o(null),h=function(){window.Stripe?e(window.Stripe):s(Error("Stripe.js not available"))},x=function(){s(Error("Failed to load Stripe.js"))},r.addEventListener("load",h),r.addEventListener("error",x)}catch(e){s(e);return}})).catch(function(e){return u=null,Promise.reject(e)})).catch(function(e){return r=null,Promise.reject(e)})};Promise.resolve().then(function(){return j()}).catch(function(e){f||console.warn(e)});var b=t(4541),N=t(4615),v=t(5196),g=t(7951);let y=(0,t(9946).A)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var w=t(2099),A=t(3568);let _=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];f=!0;var r=Date.now();return j().then(function(e){return p(e,s,r)})}(t(9509).env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);function S(){let{user:e,profile:s}=(0,b.A)(),[t,r]=(0,n.useState)(!1),i=(0,l.useRouter)(),c=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unlimited",a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e){A.Ay.error("ログインが必要です"),i.push("/auth/login");return}if((null==s?void 0:s.subscription_status)==="unlimited"&&!a)return void A.Ay.success("既に無制限プランをご利用中です");if((null==s?void 0:s.subscription_status)==="monthly"&&a)return void A.Ay.success("既に月額プランをご利用中です");r(!0);try{var n;let{data:e,error:s}=await w.N.functions.invoke("create-subscription",{body:{plan_type:t,is_subscription:a},headers:{Authorization:"Bearer ".concat(null==(n=(await w.N.auth.getSession()).data.session)?void 0:n.access_token)}});if(s)throw s;let r=await _;if(!r)throw Error("Stripeの初期化に失敗しました");let{error:l}=await r.confirmPayment({clientSecret:e.data.clientSecret,confirmParams:{return_url:"".concat(window.location.origin,"/payment/success")}});if(l)throw Error(l.message)}catch(e){console.error("Subscription error:",e),A.Ay.error(e.message||"支払いの処理に失敗しました")}finally{r(!1)}};return(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(N.A,{}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-12",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold gradient-text mb-4",children:"プラン一覧"}),(0,a.jsx)("p",{className:"text-xl text-gray-600",children:"あなたに合ったプランをお選びください"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-8 mb-12",children:[(0,a.jsxs)("div",{className:"card border-2 border-gray-200",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:"無料プラン"}),(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-600 mb-2",children:"\xa50"}),(0,a.jsx)("p",{className:"text-gray-500",children:"毎日利用できます"})]}),(0,a.jsxs)("ul",{className:"space-y-3 mb-6",children:[(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"1日7回までテスト可能"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"すべてのカテゴリ利用可能"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"結果の保存と履歴"})]})]}),(0,a.jsx)("button",{className:"w-full btn-secondary",disabled:!0,children:"現在のプラン"})]}),(0,a.jsxs)("div",{className:"card border-2 border-brand-500 bg-gradient-to-br from-brand-50 to-accent-50 relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-4 right-4 bg-gradient-to-r from-yellow-400 to-orange-400 text-white px-3 py-1 rounded-full text-sm font-medium",children:"おすすめ"}),(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold gradient-text mb-2 flex items-center justify-center",children:[(0,a.jsx)(g.A,{className:"w-6 h-6 mr-2"}),"無制限プラン"]}),(0,a.jsx)("div",{className:"text-4xl font-bold gradient-text mb-2",children:"\xa5300"}),(0,a.jsx)("p",{className:"text-brand-700",children:"一度のお支払いで無制限"})]}),(0,a.jsxs)("ul",{className:"space-y-3 mb-6",children:[(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(y,{className:"w-5 h-5 text-brand-500 mr-2"}),(0,a.jsx)("span",{className:"font-medium",children:"無制限でテスト可能"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"すべてのカテゴリ利用可能"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"結果の保存と履歴"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"新しいテストへの早期アクセス"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"特別な結果コンテンツ"})]})]}),(0,a.jsx)("button",{onClick:()=>c("unlimited"),disabled:t||(null==s?void 0:s.subscription_status)==="unlimited",className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:t?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"処理中..."]}):(null==s?void 0:s.subscription_status)==="unlimited"?"現在のプラン":"今すぐ始める"})]}),(0,a.jsxs)("div",{className:"card border-2 border-accent-500 bg-gradient-to-br from-accent-50 to-blue-50 relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-4 right-4 bg-gradient-to-r from-blue-400 to-accent-400 text-white px-3 py-1 rounded-full text-sm font-medium",children:"定期購読"}),(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold gradient-text mb-2 flex items-center justify-center",children:[(0,a.jsx)(g.A,{className:"w-6 h-6 mr-2"}),"月額プラン"]}),(0,a.jsx)("div",{className:"text-4xl font-bold text-accent-600 mb-2",children:"\xa5480"}),(0,a.jsx)("p",{className:"text-accent-700",children:"毎月自動更新"})]}),(0,a.jsxs)("ul",{className:"space-y-3 mb-6",children:[(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(y,{className:"w-5 h-5 text-accent-500 mr-2"}),(0,a.jsx)("span",{className:"font-medium",children:"無制限でテスト可能"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"すべてのカテゴリ利用可能"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"プレミアムテストにアクセス"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"パーソナルデータの分析"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-500 mr-2"}),(0,a.jsx)("span",{children:"VIPサポート"})]})]}),(0,a.jsx)("button",{onClick:()=>c("monthly",!0),disabled:t||(null==s?void 0:s.subscription_status)==="monthly",className:"w-full btn-secondary bg-accent-500 hover:bg-accent-600 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:t?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"処理中..."]}):(null==s?void 0:s.subscription_status)==="monthly"?"現在のプラン":"月額プランで始める"})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-center mb-6 gradient-text",children:"よくある質問"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"Q: 支払いは一度だけですか？"}),(0,a.jsx)("p",{className:"text-gray-600",children:"A: 無制限プランは一度のお支払いで永続的にご利用いただけます。月額プランは毎月自動更新されます。"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"Q: テストの種類はどのくらいありますか？"}),(0,a.jsx)("p",{className:"text-gray-600",children:"A: 心理テスト、星座テスト、恋愛テストの3カテゴリで、定期的に新しいテストを追加しています。"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"Q: 無料プランでも十分楽しめますか？"}),(0,a.jsx)("p",{className:"text-gray-600",children:"A: はい、1日7回までという制限はありますが、すべての基本機能をご利用いただけます。"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"Q: 月額プランはいつでも解約できますか？"}),(0,a.jsx)("p",{className:"text-gray-600",children:"A: はい、いつでも解約可能です。解約後は次回の更新日まで機能をご利用いただけます。"})]})]})]})]})})]})}}},e=>{e.O(0,[647,95,46,568,441,964,358],()=>e(e.s=1100)),_N_E=e.O()}]);