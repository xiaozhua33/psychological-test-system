(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[918],{1385:(e,t,s)=>{Promise.resolve().then(s.bind(s,1631))},1631:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(5155),r=s(2115),l=s(5695),i=s(4541),n=s(5576),c=s(4615),d=s(1007),o=s(7951),u=s(9074),m=s(9946);let x=(0,m.A)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),h=(0,m.A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var p=s(8564),N=s(2099),g=s(6874),y=s.n(g);function f(){let{user:e,profile:t,loading:s}=(0,i.A)(),{checkDailyLimit:m}=(0,n.N)(),[g,f]=(0,r.useState)(null),[j,v]=(0,r.useState)([]),[b,w]=(0,r.useState)(!0),k=(0,l.useRouter)();(0,r.useEffect)(()=>{if(!s&&!e)return void k.push("/auth/login");e&&_()},[e,s]);let _=async()=>{w(!0);try{let t=await m();f(t);let{data:s,error:a}=await N.N.from("user_tests").select("*").eq("user_id",e.id).order("completed_at",{ascending:!1}).limit(5);a?console.error("Error loading tests:",a):v(s||[])}catch(e){console.error("Error loading page data:",e)}finally{w(!1)}};return s||b?(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(c.A,{}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-600"})})})]}):e?(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(c.A,{}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold gradient-text mb-2",children:"マイページ"}),(0,a.jsx)("p",{className:"text-gray-600",children:"あなたのテスト結果や統計情報を確認できます"})]}),(0,a.jsxs)("div",{className:"card mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-brand-500 to-accent-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(d.A,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:(null==t?void 0:t.display_name)||"ユーザー"}),(0,a.jsx)("p",{className:"text-gray-600",children:e.email})]}),(null==t?void 0:t.subscription_status)==="unlimited"&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-gradient-to-r from-yellow-400 to-orange-400 text-white px-3 py-1 rounded-full",children:[(0,a.jsx)(o.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"無制限メンバー"})]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["登録日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-50 rounded-lg",children:(0,a.jsx)(u.A,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsx)("h3",{className:"font-medium text-gray-800",children:"今日の状況"})]}),g?(0,a.jsx)("div",{children:g.isUnlimited?(0,a.jsx)("p",{className:"text-green-600 font-medium",children:"無制限で利用可能"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-800 mb-1",children:[g.remainingTests,"回"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"残りテスト回数"})]})}):(0,a.jsx)("p",{className:"text-gray-500",children:"読み込み中..."})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"p-2 bg-purple-50 rounded-lg",children:(0,a.jsx)(x,{className:"w-5 h-5 text-purple-600"})}),(0,a.jsx)("h3",{className:"font-medium text-gray-800",children:"総テスト数"})]}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-800 mb-1",children:[j.length,"回"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"これまでの実施回数"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-50 rounded-lg",children:(0,a.jsx)(h,{className:"w-5 h-5 text-green-600"})}),(0,a.jsx)("h3",{className:"font-medium text-gray-800",children:"最終アクティビティ"})]}),j.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-sm text-gray-800 font-medium mb-1",children:new Date(j[0].completed_at).toLocaleDateString("ja-JP")}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"テスト実施"})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"まだテストを実施していません"})]})]}),(null==t?void 0:t.subscription_status)!=="unlimited"&&(0,a.jsx)("div",{className:"card bg-gradient-to-br from-brand-50 to-accent-50 border-2 border-brand-200 mb-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(o.A,{className:"w-12 h-12 text-brand-600 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-bold gradient-text mb-2",children:"無制限プランでもっと楽しもう！"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"たった\xa5300で、すべてのテストを無制限で楽しめます。"}),(0,a.jsx)(y(),{href:"/pricing",className:"btn-primary inline-block",children:"無制限プランを見る"})]})}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-6 flex items-center",children:[(0,a.jsx)(p.A,{className:"w-6 h-6 text-brand-600 mr-2"}),"最近のテスト結果"]}),j.length>0?(0,a.jsx)("div",{className:"space-y-4",children:j.map((e,t)=>(0,a.jsx)("div",{className:"border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-800 mb-1",children:["テスト #",e.test_id]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.result_summary||"結果を確認してください"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.completed_at).toLocaleString("ja-JP")})]}),(0,a.jsx)(y(),{href:"/result/".concat(e.id),className:"text-brand-600 hover:text-brand-700 text-sm font-medium",children:"結果を見る"})]})},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(x,{className:"w-8 h-8 text-gray-400"})}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"まだテストを実施していません"}),(0,a.jsx)(y(),{href:"/",className:"btn-primary",children:"テストを始める"})]})]})]})})]}):null}},2099:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});let a=(0,s(5647).UU)("https://wbvdvxgdtnpuedqsyvyc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzI2OTc2NDgzLCJleHAiOjIwNDI1NTI0ODN9.Dx10LqwjcB1UB3tr6ZVJTKKnIX4S4itZED_jEFtUlFY")},4541:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,default:()=>d});var a=s(5155),r=s(2115),l=s(2099),i=s(9509);let n=(0,r.createContext)({}),c=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function d(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{var e;let{data:{session:t}}=await l.N.auth.getSession();c(null!=(e=null==t?void 0:t.user)?e:null),(null==t?void 0:t.user)&&await x(t.user.id),m(!1)})();let{data:{subscription:e}}=l.N.auth.onAuthStateChange(async(e,t)=>{var s;c(null!=(s=null==t?void 0:t.user)?s:null),(null==t?void 0:t.user)?await x(t.user.id):o(null)});return()=>e.unsubscribe()},[]);let x=async e=>{try{let{data:r,error:i}=await l.N.from("profiles").select("*").eq("id",e).maybeSingle();if(i&&"PGRST116"!==i.code)return void console.error("Error fetching profile:",i);if(!r&&s){var t,a;let{data:r,error:i}=await l.N.from("profiles").insert({id:e,email:s.email,display_name:(null==(t=s.user_metadata)?void 0:t.display_name)||(null==(a=s.email)?void 0:a.split("@")[0]),subscription_status:"free"}).select().maybeSingle();i?console.error("Error creating profile:",i):o(r)}else o(r)}catch(e){console.error("Error in fetchProfile:",e)}},h=async(e,t)=>{let{data:s,error:a}=await l.N.auth.signInWithPassword({email:e,password:t});return{data:s,error:a}},p=async(e,t)=>{let{data:s,error:a}=await l.N.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(i.env.NEXT_PUBLIC_APP_URL,"/auth/callback")}});return{data:s,error:a}},N=async()=>{let{error:e}=await l.N.auth.signOut();return{error:e}};return(0,a.jsx)(n.Provider,{value:{user:s,profile:d,loading:u,signIn:h,signUp:p,signOut:N},children:t})}},4615:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(5155),r=s(6874),l=s.n(r),i=s(6766),n=s(1007),c=s(4835),d=s(4541);function o(){let{user:e,profile:t,signOut:s}=(0,d.A)(),r=async()=>{await s()};return(0,a.jsx)("header",{className:"bg-white/95 backdrop-blur-sm border-b border-purple-100 sticky top-0 z-40",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(l(),{href:"/",className:"flex items-center space-x-2 group",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(i.default,{src:"/images/logo.png",alt:"ココロトリックスラボ",width:40,height:40,className:"group-hover:scale-105 transition-transform"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold gradient-text group-hover:scale-105 transition-transform",children:"ココロトリックスラボ"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 hidden sm:block",children:"心理テスト・診断アプリ"})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:e?(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)(l(),{href:"/mypage",className:"flex items-center space-x-2 text-gray-600 hover:text-brand-600 transition-colors",children:[(0,a.jsx)(n.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline text-sm",children:(null==t?void 0:t.display_name)||"マイページ"})]}),(null==t?void 0:t.subscription_status)==="unlimited"&&(0,a.jsx)("span",{className:"px-2 py-1 bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-xs font-medium rounded-full",children:"無制限"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors p-2","aria-label":"ログアウト",children:(0,a.jsx)(c.A,{className:"w-4 h-4"})})]}):(0,a.jsx)(l(),{href:"/auth/login",className:"btn-primary text-sm px-4 py-2",children:"ログイン"})})]})})})}},5576:(e,t,s)=>{"use strict";s.d(t,{N:()=>i});var a=s(2115),r=s(2099),l=s(9509);function i(){let{user:e}=function(){let[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(null),[n,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{var e;let{data:{session:s}}=await r.N.auth.getSession();t(null!=(e=null==s?void 0:s.user)?e:null),(null==s?void 0:s.user)&&await d(s.user.id),c(!1)})();let{data:{subscription:e}}=r.N.auth.onAuthStateChange(async(e,s)=>{var a;t(null!=(a=null==s?void 0:s.user)?a:null),(null==s?void 0:s.user)?await d(s.user.id):i(null)});return()=>e.unsubscribe()},[]);let d=async t=>{try{let{data:l,error:n}=await r.N.from("profiles").select("*").eq("id",t).maybeSingle();if(n&&"PGRST116"!==n.code)return void console.error("Error fetching profile:",n);if(!l&&e){var s,a;let{data:l,error:n}=await r.N.from("profiles").insert({id:t,email:e.email,display_name:(null==(s=e.user_metadata)?void 0:s.display_name)||(null==(a=e.email)?void 0:a.split("@")[0]),subscription_status:"free"}).select().single();n?console.error("Error creating profile:",n):i(l)}else i(l)}catch(e){console.error("Error in fetchProfile:",e)}};return{user:e,profile:s,loading:n,signIn:async(e,t)=>{let{data:s,error:a}=await r.N.auth.signInWithPassword({email:e,password:t});return{data:s,error:a}},signUp:async(e,t)=>{let{data:s,error:a}=await r.N.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(l.env.NEXT_PUBLIC_APP_URL,"/auth/callback")}});return{data:s,error:a}},signOut:async()=>{let{error:e}=await r.N.auth.signOut();return{error:e}}}}(),[t,s]=(0,a.useState)(!1),[i,n]=(0,a.useState)(null);return{loading:t,error:i,checkDailyLimit:(0,a.useCallback)(async()=>{if(!e)return null;s(!0),n(null);try{var t;let{data:e,error:s}=await r.N.functions.invoke("check-daily-limit",{headers:{Authorization:"Bearer ".concat(null==(t=(await r.N.auth.getSession()).data.session)?void 0:t.access_token)}});if(s)throw s;return e.data}catch(e){return n(e.message||"テスト制限の確認に失敗しました"),console.error("Error checking daily limit:",e),null}finally{s(!1)}},[e]),updateTestCount:(0,a.useCallback)(async()=>{if(!e)return null;s(!0),n(null);try{var t;let{data:e,error:s}=await r.N.functions.invoke("update-test-count",{headers:{Authorization:"Bearer ".concat(null==(t=(await r.N.auth.getSession()).data.session)?void 0:t.access_token)}});if(s)throw s;return e.data}catch(e){return n(e.message||"テスト回数の更新に失敗しました"),console.error("Error updating test count:",e),null}finally{s(!1)}},[e])}}},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},7951:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]])},8564:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},9074:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])}},e=>{e.O(0,[647,95,46,441,964,358],()=>e(e.s=1385)),_N_E=e.O()}]);